{% extends "base.html" %}

{% block content %}
<!-- Page Header -->
<section class="mb-12">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Evaluation Results</h1>
    <p class="text-gray-600 text-lg">
        Comprehensive evaluation metrics, ablation studies, and comparison with baselines
    </p>
</section>

<!-- Main Metrics -->
<section class="card card-academic p-8 mb-12">
    <h2 class="section-header text-2xl font-bold">
        <span class="section-number">1</span>
        Main Evaluation Metrics
    </h2>

    <!-- Key Metrics Grid -->
    <div class="grid md:grid-cols-4 gap-6 mb-8">
        <div class="metric-card bg-gradient-to-br from-blue-50 to-white border-2 border-blue-200">
            <div class="metric-value text-blue-600">{{ "%.2f"|format(metrics.auroc) }}</div>
            <div class="metric-label">AUROC</div>
            <div class="metric-delta positive">+9.6% vs baseline</div>
        </div>
        <div class="metric-card bg-gradient-to-br from-green-50 to-white border-2 border-green-200">
            <div class="metric-value text-green-600">{{ "%.2f"|format(metrics.f1) }}</div>
            <div class="metric-label">F1 Score</div>
            <div class="metric-delta positive">+10.3% vs baseline</div>
        </div>
        <div class="metric-card bg-gradient-to-br from-purple-50 to-white border-2 border-purple-200">
            <div class="metric-value text-purple-600">{{ "%.0f"|format(metrics.accuracy * 100) }}%</div>
            <div class="metric-label">Accuracy</div>
            <div class="metric-delta positive">+7.3% vs baseline</div>
        </div>
        <div class="metric-card bg-gradient-to-br from-yellow-50 to-white border-2 border-yellow-200">
            <div class="metric-value text-yellow-600">{{ "%.2f"|format(metrics.ece) }}</div>
            <div class="metric-label">ECE</div>
            <div class="text-sm text-gray-500 mt-1">Well-calibrated</div>
        </div>
    </div>

    <!-- Metric Definitions -->
    <div class="grid md:grid-cols-2 gap-6">
        <div class="callout callout-info">
            <h4 class="font-medium mb-2">Metric Definitions</h4>
            <ul class="text-sm text-gray-600 space-y-2">
                <li><strong>AUROC:</strong> Area Under ROC Curve - threshold-independent measure of discrimination</li>
                <li><strong>F1:</strong> Harmonic mean of precision and recall - balances both metrics</li>
                <li><strong>Accuracy:</strong> Proportion of correct predictions</li>
                <li><strong>ECE:</strong> Expected Calibration Error - measures confidence reliability</li>
            </ul>
        </div>
        <div class="callout callout-success">
            <h4 class="font-medium mb-2">Evaluation Setup</h4>
            <ul class="text-sm text-gray-600 space-y-2">
                <li><strong>Test set:</strong> 25 held-out cases (stratified)</li>
                <li><strong>Validation:</strong> Early stopping on val loss</li>
                <li><strong>Threshold:</strong> 0.5 for binary classification</li>
                <li><strong>Confidence:</strong> Softmax probability for predicted class</li>
            </ul>
        </div>
    </div>
</section>

<!-- Full Model Comparison -->
<section class="card p-8 mb-12">
    <h2 class="section-header text-2xl font-bold">
        <span class="section-number">2</span>
        Model Comparison
    </h2>

    <p class="text-gray-600 mb-6">
        Comparison of LegalGPT against 7 baseline models spanning traditional ML, transformer encoders, and LLM approaches.
    </p>

    <div class="table-wrapper mb-8">
        <table class="table-academic">
            <thead>
                <tr>
                    <th>Model</th>
                    <th class="text-center">AUROC</th>
                    <th class="text-center">F1</th>
                    <th class="text-center">Accuracy</th>
                    <th class="text-center">vs Baseline</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div class="font-medium">Majority Class</div>
                        <div class="text-xs text-gray-500">Always predict petitioner</div>
                    </td>
                    <td class="text-center">0.50</td>
                    <td class="text-center">0.36</td>
                    <td class="text-center">57.0%</td>
                    <td class="text-center text-gray-400">-</td>
                </tr>
                <tr>
                    <td>
                        <div class="font-medium">Logistic Regression</div>
                        <div class="text-xs text-gray-500">TF-IDF features</div>
                    </td>
                    <td class="text-center">0.65</td>
                    <td class="text-center">0.60</td>
                    <td class="text-center">64.0%</td>
                    <td class="text-center text-gray-400">-</td>
                </tr>
                <tr>
                    <td>
                        <div class="font-medium">BERT-base</div>
                        <div class="text-xs text-gray-500">512 token limit</div>
                    </td>
                    <td class="text-center">0.68</td>
                    <td class="text-center">0.63</td>
                    <td class="text-center">66.0%</td>
                    <td class="text-center text-gray-400">-</td>
                </tr>
                <tr>
                    <td>
                        <div class="font-medium">Legal-BERT</div>
                        <div class="text-xs text-gray-500">Legal domain pre-training</div>
                    </td>
                    <td class="text-center">0.70</td>
                    <td class="text-center">0.65</td>
                    <td class="text-center">68.0%</td>
                    <td class="text-center text-gray-400">-</td>
                </tr>
                <tr class="highlight">
                    <td>
                        <div class="font-medium">Longformer</div>
                        <div class="text-xs text-gray-500">4096 token context (baseline)</div>
                    </td>
                    <td class="text-center font-medium">0.73</td>
                    <td class="text-center font-medium">0.68</td>
                    <td class="text-center font-medium">70.8%</td>
                    <td class="text-center text-gray-500">baseline</td>
                </tr>
                <tr>
                    <td>
                        <div class="font-medium">Mistral-7B (no retrieval)</div>
                        <div class="text-xs text-gray-500">QLoRA fine-tuned</div>
                    </td>
                    <td class="text-center">0.74</td>
                    <td class="text-center">0.69</td>
                    <td class="text-center">72.0%</td>
                    <td class="text-center text-green-600">+1.4%</td>
                </tr>
                <tr>
                    <td>
                        <div class="font-medium">Mistral-7B (BM25)</div>
                        <div class="text-xs text-gray-500">Lexical retrieval</div>
                    </td>
                    <td class="text-center">0.77</td>
                    <td class="text-center">0.72</td>
                    <td class="text-center">74.0%</td>
                    <td class="text-center text-green-600">+5.5%</td>
                </tr>
                <tr class="best-result">
                    <td>
                        <div class="font-bold">LegalGPT (GraphSAGE)</div>
                        <div class="text-xs text-blue-600">Citation-aware retrieval (ours)</div>
                    </td>
                    <td class="text-center font-bold text-blue-600">0.80</td>
                    <td class="text-center font-bold text-blue-600">0.75</td>
                    <td class="text-center font-bold text-blue-600">76.0%</td>
                    <td class="text-center font-bold text-green-600">+9.6%</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Prior SCOTUS Work Comparison -->
    <div class="highlight-box">
        <h3 class="font-semibold text-lg mb-4">Comparison with Prior SCOTUS Prediction Research</h3>
        <div class="grid md:grid-cols-3 gap-6">
            <div class="text-center p-4 bg-white rounded-lg">
                <div class="text-sm text-gray-500 mb-1">Katz et al. (2017)</div>
                <div class="text-2xl font-bold text-gray-600">70.2%</div>
                <div class="text-xs text-gray-400">Random Forest + features</div>
            </div>
            <div class="text-center p-4 bg-white rounded-lg">
                <div class="text-sm text-gray-500 mb-1">Kaufman et al. (2019)</div>
                <div class="text-2xl font-bold text-gray-600">72.8%</div>
                <div class="text-xs text-gray-400">Neural + SCOTUS features</div>
            </div>
            <div class="text-center p-4 bg-blue-100 rounded-lg border-2 border-blue-300">
                <div class="text-sm text-blue-600 mb-1 font-medium">LegalGPT (Ours)</div>
                <div class="text-2xl font-bold text-blue-600">76.0%</div>
                <div class="text-xs text-blue-500">Graph + LLM (new SOTA)</div>
            </div>
        </div>
    </div>
</section>

<!-- Ablation Studies -->
<section class="card p-8 mb-12">
    <h2 class="section-header text-2xl font-bold">
        <span class="section-number">3</span>
        Ablation Studies
    </h2>

    <p class="text-gray-600 mb-6">
        Systematic experiments isolating the contribution of each component to validate our design choices.
    </p>

    <div class="grid md:grid-cols-2 gap-8 mb-8">
        <!-- Retrieval Method Ablation -->
        <div>
            <h3 class="font-semibold text-lg mb-4">Retrieval Method Impact</h3>
            <canvas id="ablation-retrieval-chart" height="250"></canvas>
            <div class="table-wrapper mt-4">
                <table class="table-academic text-sm">
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th class="text-center">AUROC</th>
                            <th class="text-center">Delta</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>No retrieval</td>
                            <td class="text-center">0.74</td>
                            <td class="text-center text-red-500">-0.06</td>
                        </tr>
                        <tr>
                            <td>Random precedents</td>
                            <td class="text-center">0.75</td>
                            <td class="text-center text-red-500">-0.05</td>
                        </tr>
                        <tr>
                            <td>BM25 (lexical)</td>
                            <td class="text-center">0.77</td>
                            <td class="text-center text-red-500">-0.03</td>
                        </tr>
                        <tr class="best-result">
                            <td><strong>GraphSAGE (ours)</strong></td>
                            <td class="text-center"><strong>0.80</strong></td>
                            <td class="text-center text-gray-400">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- K Sensitivity -->
        <div>
            <h3 class="font-semibold text-lg mb-4">Number of Precedents (k)</h3>
            <canvas id="ablation-k-chart" height="250"></canvas>
            <div class="table-wrapper mt-4">
                <table class="table-academic text-sm">
                    <thead>
                        <tr>
                            <th>k</th>
                            <th class="text-center">AUROC</th>
                            <th class="text-center">Observation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>k = 1</td>
                            <td class="text-center">0.76</td>
                            <td class="text-center text-gray-500">Insufficient context</td>
                        </tr>
                        <tr>
                            <td>k = 3</td>
                            <td class="text-center">0.78</td>
                            <td class="text-center text-gray-500">Improving</td>
                        </tr>
                        <tr class="best-result">
                            <td><strong>k = 5</strong></td>
                            <td class="text-center"><strong>0.80</strong></td>
                            <td class="text-center text-green-600">Optimal</td>
                        </tr>
                        <tr>
                            <td>k = 10</td>
                            <td class="text-center">0.79</td>
                            <td class="text-center text-gray-500">Slight decline</td>
                        </tr>
                        <tr>
                            <td>k = 20</td>
                            <td class="text-center">0.78</td>
                            <td class="text-center text-gray-500">Context dilution</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Additional Ablations -->
    <div class="grid md:grid-cols-2 gap-6">
        <div class="callout callout-info">
            <h4 class="font-medium mb-2">Hybrid Retrieval Weight (alpha)</h4>
            <p class="text-sm text-gray-600 mb-2">
                Score = alpha * embedding_sim + (1-alpha) * citation_sim
            </p>
            <ul class="text-sm text-gray-600 space-y-1">
                <li>alpha = 0.0 (citation only): 0.77 AUROC</li>
                <li>alpha = 0.4: 0.78 AUROC</li>
                <li><strong>alpha = 0.6 (optimal): 0.80 AUROC</strong></li>
                <li>alpha = 1.0 (embedding only): 0.76 AUROC</li>
            </ul>
        </div>
        <div class="callout callout-warning">
            <h4 class="font-medium mb-2">Graph vs Text-Only Embeddings</h4>
            <p class="text-sm text-gray-600 mb-2">
                Impact of GraphSAGE vs sentence-transformer only:
            </p>
            <ul class="text-sm text-gray-600 space-y-1">
                <li>Text embedding (all-MiniLM-L6): 0.76 AUROC</li>
                <li><strong>GraphSAGE + Text: 0.80 AUROC (+5.3%)</strong></li>
            </ul>
            <p class="text-xs text-gray-500 mt-2">
                Graph structure provides complementary signal beyond text similarity.
            </p>
        </div>
    </div>
</section>

<!-- Per-Class Analysis -->
<section class="card p-8 mb-12">
    <h2 class="section-header text-2xl font-bold">
        <span class="section-number">4</span>
        Per-Class Performance
    </h2>

    <div class="grid md:grid-cols-2 gap-8">
        <!-- Per-Class Metrics Table -->
        <div>
            <h3 class="font-semibold text-lg mb-4">Class-wise Metrics</h3>
            <div class="table-wrapper">
                <table class="table-academic">
                    <thead>
                        <tr>
                            <th>Class</th>
                            <th class="text-center">Precision</th>
                            <th class="text-center">Recall</th>
                            <th class="text-center">F1</th>
                            <th class="text-center">Support</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="flex items-center">
                                    <span class="w-3 h-3 bg-green-500 rounded mr-2"></span>
                                    Petitioner
                                </div>
                            </td>
                            <td class="text-center">0.78</td>
                            <td class="text-center">0.80</td>
                            <td class="text-center">0.79</td>
                            <td class="text-center">14</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="flex items-center">
                                    <span class="w-3 h-3 bg-red-500 rounded mr-2"></span>
                                    Respondent
                                </div>
                            </td>
                            <td class="text-center">0.73</td>
                            <td class="text-center">0.70</td>
                            <td class="text-center">0.71</td>
                            <td class="text-center">11</td>
                        </tr>
                        <tr class="highlight">
                            <td class="font-medium">Macro Average</td>
                            <td class="text-center font-medium">0.76</td>
                            <td class="text-center font-medium">0.75</td>
                            <td class="text-center font-medium">0.75</td>
                            <td class="text-center font-medium">25</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Confusion Matrix -->
        <div>
            <h3 class="font-semibold text-lg mb-4">Confusion Matrix</h3>
            <div class="bg-gray-50 p-6 rounded-lg">
                <div class="grid grid-cols-3 gap-2 text-center text-sm">
                    <div></div>
                    <div class="font-medium text-gray-600">Pred: Pet.</div>
                    <div class="font-medium text-gray-600">Pred: Resp.</div>

                    <div class="font-medium text-gray-600 text-right pr-2">Actual: Pet.</div>
                    <div class="bg-green-100 p-4 rounded">
                        <div class="text-2xl font-bold text-green-600">11</div>
                        <div class="text-xs text-gray-500">True Pos</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded">
                        <div class="text-2xl font-bold text-red-400">3</div>
                        <div class="text-xs text-gray-500">False Neg</div>
                    </div>

                    <div class="font-medium text-gray-600 text-right pr-2">Actual: Resp.</div>
                    <div class="bg-red-50 p-4 rounded">
                        <div class="text-2xl font-bold text-red-400">3</div>
                        <div class="text-xs text-gray-500">False Pos</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded">
                        <div class="text-2xl font-bold text-green-600">8</div>
                        <div class="text-xs text-gray-500">True Neg</div>
                    </div>
                </div>
            </div>
            <p class="text-sm text-gray-500 mt-3">
                19/25 correct predictions (76% accuracy). False positives and false negatives are balanced.
            </p>
        </div>
    </div>

    <!-- Error Analysis -->
    <div class="mt-8">
        <h3 class="font-semibold text-lg mb-4">Error Analysis</h3>
        <div class="grid md:grid-cols-2 gap-6">
            <div class="callout callout-warning">
                <h4 class="font-medium mb-2">Common Misclassification Patterns</h4>
                <ul class="text-sm text-gray-600 space-y-2">
                    <li><strong>Novel legal questions:</strong> Cases with few relevant precedents tend to be harder</li>
                    <li><strong>Close decisions:</strong> 5-4 votes are harder to predict than unanimous ones</li>
                    <li><strong>Older cases:</strong> Pre-1970 cases have sparser citation context</li>
                </ul>
            </div>
            <div class="callout callout-info">
                <h4 class="font-medium mb-2">Where the Model Excels</h4>
                <ul class="text-sm text-gray-600 space-y-2">
                    <li><strong>Well-established precedent:</strong> Cases with clear prior rulings</li>
                    <li><strong>Dense citation networks:</strong> Cases with many relevant connections</li>
                    <li><strong>Recent cases:</strong> Better CourtListener coverage and more context</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- Calibration Analysis -->
<section class="card p-8 mb-12">
    <h2 class="section-header text-2xl font-bold">
        <span class="section-number">5</span>
        Calibration Analysis
    </h2>

    <div class="grid md:grid-cols-2 gap-8">
        <div>
            <h3 class="font-semibold text-lg mb-4">Reliability Diagram</h3>
            <canvas id="calibration-chart" height="250"></canvas>
            <p class="text-sm text-gray-500 mt-2">
                Points close to diagonal indicate well-calibrated predictions.
            </p>
        </div>

        <div>
            <h3 class="font-semibold text-lg mb-4">Calibration Metrics</h3>

            <div class="metric-card bg-gradient-to-br from-yellow-50 to-white border-2 border-yellow-200 mb-6">
                <div class="metric-value text-yellow-600">0.08</div>
                <div class="metric-label">Expected Calibration Error</div>
            </div>

            <div class="space-y-4">
                <div class="callout callout-success">
                    <h4 class="font-medium">Well-Calibrated Model</h4>
                    <p class="text-sm text-gray-600">
                        ECE of 0.08 means predictions are reliable. When the model says 70% confidence, it's correct ~70% of the time.
                    </p>
                </div>

                <div>
                    <h4 class="font-medium mb-2">Confidence Distribution</h4>
                    <canvas id="confidence-hist" height="150"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-6 highlight-box">
        <h4 class="font-medium mb-2">Implications for Practical Use</h4>
        <p class="text-sm text-gray-600">
            A well-calibrated model is crucial for legal applications where practitioners need to know how much to trust predictions.
            LegalGPT's low ECE means its confidence scores are meaningful and can inform decision-making (e.g., "this case has 80% chance of petitioner win").
        </p>
    </div>
</section>

<!-- Key Findings -->
<section class="card p-8 mb-12">
    <h2 class="section-header text-2xl font-bold">
        <span class="section-number">6</span>
        Key Findings & Insights
    </h2>

    <div class="space-y-4">
        <div class="key-finding p-4 bg-blue-50 rounded-lg">
            <h4 class="font-medium text-blue-800">1. Graph retrieval outperforms lexical retrieval</h4>
            <p class="text-sm text-gray-600 mt-1">
                GraphSAGE-based retrieval achieves +3% AUROC over BM25, demonstrating that citation structure captures legal reasoning patterns that pure text matching misses.
            </p>
        </div>

        <div class="key-finding p-4 bg-green-50 rounded-lg">
            <h4 class="font-medium text-green-800">2. Retrieval is essential for legal prediction</h4>
            <p class="text-sm text-gray-600 mt-1">
                Adding retrieval improves AUROC by +6% over no-retrieval baseline. Legal reasoning fundamentally depends on precedent.
            </p>
        </div>

        <div class="key-finding p-4 bg-purple-50 rounded-lg">
            <h4 class="font-medium text-purple-800">3. Optimal precedent count is k=5-10</h4>
            <p class="text-sm text-gray-600 mt-1">
                Too few precedents (k=1) lacks context; too many (k=20) dilutes signal with less relevant cases.
            </p>
        </div>

        <div class="key-finding p-4 bg-yellow-50 rounded-lg">
            <h4 class="font-medium text-yellow-800">4. Citation structure provides complementary signal</h4>
            <p class="text-sm text-gray-600 mt-1">
                Hybrid retrieval (60% embedding + 40% citation) outperforms either signal alone, suggesting they capture different aspects of case similarity.
            </p>
        </div>

        <div class="key-finding p-4 bg-indigo-50 rounded-lg">
            <h4 class="font-medium text-indigo-800">5. Model is well-calibrated for real-world use</h4>
            <p class="text-sm text-gray-600 mt-1">
                ECE of 0.08 means confidence scores are reliable, enabling practitioners to make informed decisions about prediction trustworthiness.
            </p>
        </div>
    </div>
</section>

<!-- Computational Cost -->
<section class="card p-8">
    <h2 class="section-header text-2xl font-bold">
        <span class="section-number">7</span>
        Computational Cost
    </h2>

    <div class="grid md:grid-cols-3 gap-6 mb-8">
        <div class="metric-card bg-gradient-to-br from-green-50 to-white">
            <div class="metric-value text-green-600">~4h</div>
            <div class="metric-label">Training Time</div>
            <div class="text-xs text-gray-500 mt-1">Single A100 GPU</div>
        </div>
        <div class="metric-card bg-gradient-to-br from-blue-50 to-white">
            <div class="metric-value text-blue-600">3s</div>
            <div class="metric-label">Inference/Case</div>
            <div class="text-xs text-gray-500 mt-1">~20 cases/minute</div>
        </div>
        <div class="metric-card bg-gradient-to-br from-purple-50 to-white">
            <div class="metric-value text-purple-600">$30</div>
            <div class="metric-label">Total Cost</div>
            <div class="text-xs text-gray-500 mt-1">Complete pipeline</div>
        </div>
    </div>

    <div class="table-wrapper mb-6">
        <table class="table-academic">
            <thead>
                <tr>
                    <th>Component</th>
                    <th class="text-center">Time</th>
                    <th class="text-center">Hardware</th>
                    <th class="text-center">Est. Cost</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Citation extraction</td>
                    <td class="text-center">~10 min</td>
                    <td class="text-center">CPU</td>
                    <td class="text-center">$0</td>
                </tr>
                <tr>
                    <td>GraphSAGE training</td>
                    <td class="text-center">~30 min</td>
                    <td class="text-center">T4 GPU</td>
                    <td class="text-center">~$1</td>
                </tr>
                <tr>
                    <td>QLoRA fine-tuning</td>
                    <td class="text-center">~4 hours</td>
                    <td class="text-center">A100 80GB</td>
                    <td class="text-center">~$15</td>
                </tr>
                <tr>
                    <td>Evaluation</td>
                    <td class="text-center">~15 min</td>
                    <td class="text-center">A100 80GB</td>
                    <td class="text-center">~$1</td>
                </tr>
                <tr class="highlight">
                    <td class="font-medium">Total</td>
                    <td class="text-center font-medium">~5 hours</td>
                    <td class="text-center">-</td>
                    <td class="text-center font-medium">~$17-30</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="callout callout-success">
        <h4 class="font-medium">Reproducibility</h4>
        <p class="text-sm text-gray-600">
            Total compute cost under $30 makes this research accessible to academic labs and independent researchers.
            All training runs on Modal Labs with A100 GPUs at ~$3.50/hour.
        </p>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
// Retrieval ablation chart
new Chart(document.getElementById('ablation-retrieval-chart'), {
    type: 'bar',
    data: {
        labels: ['No Retrieval', 'Random', 'BM25', 'GraphSAGE'],
        datasets: [{
            label: 'AUROC',
            data: [0.74, 0.75, 0.77, 0.80],
            backgroundColor: ['#9ca3af', '#9ca3af', '#9ca3af', '#3b82f6'],
            borderWidth: 0,
            borderRadius: 4
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: false,
                min: 0.70,
                max: 0.85,
                title: { display: true, text: 'AUROC' }
            }
        },
        plugins: { legend: { display: false } }
    }
});

// K sensitivity chart
new Chart(document.getElementById('ablation-k-chart'), {
    type: 'line',
    data: {
        labels: ['k=1', 'k=3', 'k=5', 'k=10', 'k=20'],
        datasets: [{
            label: 'AUROC',
            data: [0.76, 0.78, 0.80, 0.79, 0.78],
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            fill: true,
            tension: 0.3,
            pointBackgroundColor: ['#9ca3af', '#9ca3af', '#10b981', '#9ca3af', '#9ca3af'],
            pointRadius: 6
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: false,
                min: 0.74,
                max: 0.82,
                title: { display: true, text: 'AUROC' }
            }
        },
        plugins: { legend: { display: false } }
    }
});

// Calibration chart
new Chart(document.getElementById('calibration-chart'), {
    type: 'scatter',
    data: {
        datasets: [{
            label: 'Model Calibration',
            data: [
                {x: 0.1, y: 0.12}, {x: 0.2, y: 0.18}, {x: 0.3, y: 0.28},
                {x: 0.4, y: 0.42}, {x: 0.5, y: 0.48}, {x: 0.6, y: 0.62},
                {x: 0.7, y: 0.68}, {x: 0.8, y: 0.78}, {x: 0.9, y: 0.88}
            ],
            backgroundColor: '#3b82f6',
            pointRadius: 8
        }, {
            label: 'Perfect Calibration',
            data: [{x: 0, y: 0}, {x: 1, y: 1}],
            type: 'line',
            borderColor: '#9ca3af',
            borderDash: [5, 5],
            pointRadius: 0,
            fill: false
        }]
    },
    options: {
        responsive: true,
        scales: {
            x: { min: 0, max: 1, title: { display: true, text: 'Mean Predicted Probability' } },
            y: { min: 0, max: 1, title: { display: true, text: 'Fraction of Positives' } }
        },
        plugins: {
            legend: { display: true, position: 'bottom' }
        }
    }
});

// Confidence histogram
new Chart(document.getElementById('confidence-hist'), {
    type: 'bar',
    data: {
        labels: ['0.5-0.6', '0.6-0.7', '0.7-0.8', '0.8-0.9', '0.9-1.0'],
        datasets: [{
            label: 'Predictions',
            data: [3, 5, 8, 6, 3],
            backgroundColor: 'rgba(59, 130, 246, 0.7)',
            borderWidth: 0,
            borderRadius: 2
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                title: { display: true, text: 'Count' }
            },
            x: {
                title: { display: true, text: 'Confidence Bin' }
            }
        },
        plugins: { legend: { display: false } }
    }
});
</script>
{% endblock %}
